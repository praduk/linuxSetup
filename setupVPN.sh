#!/bin/bash
# RUN WITH ROOT
if [[ $EUID -ne 0 ]]; then
   echo "This script needs root privilages." 
   exit 1
fi


VPN_SERVER_IP='RadicalDreamers.DLinkDDNS.com'
VPN_IPSEC_PSK='Dofus7'
VPN_USER='Slum'
VPN_PASSWORD='Chess252'

apt-get -y install strongswan xl2tpd


cat > /etc/ipsec.conf <<EOF
# ipsec.conf - strongSwan IPsec configuration file

# basic configuration

config setup
  # strictcrlpolicy=yes
  # uniqueids = no

# Add connections here.

# Sample VPN connections

conn %default
  ikelifetime=60m
  keylife=20m
  rekeymargin=3m
  keyingtries=1
  keyexchange=ikev1
  authby=secret
  ike=aes128-sha1-modp1024,3des-sha1-modp1024!
  esp=aes128-sha1-modp1024,3des-sha1-modp1024!

conn myvpn
  keyexchange=ikev1
  left=%defaultroute
  auto=add
  authby=secret
  type=transport
  leftprotoport=17/1701
  rightprotoport=17/1701
  right=$VPN_SERVER_IP
EOF

cat > /etc/ipsec.secrets <<EOF
: PSK "$VPN_IPSEC_PSK"
EOF

chmod 600 /etc/ipsec.secrets
